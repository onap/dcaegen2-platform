
#description: Hello World mS for subscribing the data from local DMaaP, DR or MR, processing them and publishing them as PM files to local DMaaP DR
#blueprint_version: 1.0.1
---
tosca_definitions_version: cloudify_dsl_1_3
description: Hello World mS for subscribing the data from local DMaaP, DR or MR, processing
  them and publishing them as PM files to local DMaaP DR
imports:
- https://www.getcloudify.org/spec/cloudify/4.5.5/types.yaml
- https://nexus.onap.org/service/local/repositories/raw/content/org.onap.dcaegen2.platform.plugins/R6/k8splugin/1.7.1/k8splugin_types.yaml
- https://nexus.onap.org/service/local/repositories/raw/content/org.onap.ccsdk.platform.plugins/type_files/dmaap/dmaap.yaml
inputs:
  DCAE-HELLO-WORLD-PUB-DR_feed0_location:
    type: string
  DCAE-HELLO-WORLD-PUB-MR_topic1_aaf_password:
    type: string
  DCAE-HELLO-WORLD-PUB-MR_topic1_aaf_username:
    type: string
  DCAE-HELLO-WORLD-PUB-MR_topic1_client_role:
    type: string
  DCAE-HELLO-WORLD-PUB-MR_topic1_location:
    type: string
  DCAE-HELLO-WORLD-SUB-DR_feed3_decompress:
    type: string
  DCAE-HELLO-WORLD-SUB-DR_feed3_location:
    type: string
  DCAE-HELLO-WORLD-SUB-DR_feed3_password:
    type: string
  DCAE-HELLO-WORLD-SUB-DR_feed3_priviliged:
    type: string
  DCAE-HELLO-WORLD-SUB-DR_feed3_username:
    type: string
  DCAE-HELLO-WORLD-SUB-MR_topic2_aaf_password:
    type: string
  DCAE-HELLO-WORLD-SUB-MR_topic2_aaf_username:
    type: string
  DCAE-HELLO-WORLD-SUB-MR_topic2_client_role:
    type: string
  DCAE-HELLO-WORLD-SUB-MR_topic2_location:
    type: string
  dcae.collectors.vcc.helloworld.pm_cpu_limit:
    type: string
    default: "250m"
  dcae.collectors.vcc.helloworld.pm_cpu_request:
    type: string
    default: "250m"
  dcae.collectors.vcc.helloworld.pm_memory_limit:
    type: string
    default: "128Mi"
  dcae.collectors.vcc.helloworld.pm_memory_request:
    type: string
    default: "128Mi"
  dcaes_database_name:
    type: string
    description: db name
    default: ""
  dcaes_database_writerfqdn:
    type: string
    description: db writerfqdn
    default: ""
  dti_database_name:
    type: string
    description: db name
    default: ""
  dti_database_writerfqdn:
    type: string
    description: db writerfqdn
    default: ""
  envs:
    default: &envs {}
  feed0_name:
    type: string
  feed3_name:
    type: string
  replicas:
    type: integer
    description: number of instances
    default: 1
  repo_database_name:
    type: string
    description: db name
    default: ""
  repo_database_writerfqdn:
    type: string
    description: db writerfqdn
    default: ""
  service_component_name_override:
    type: string
    default: ""
  tag_version:
    type: string
    default: "dockercentral.it.att.com:5100/com.att.dcae.controller/dcae-controller-vcc-helloworld-pm:18.02-001"
  tca_policy_00_policy_id:
    type: string
    description: policy_id
    default: ""
  tca_policy_11_policy_id:
    type: string
    description: policy_id
    default: "tca_policy_id_11"
  topic1_name:
    type: string
  topic2_name:
    type: string
  use_tls:
    type: boolean
    description: flag to indicate tls enable/disable
    default: true
  vcc_hello_name:
    type: string
    default: "fsdfa"
node_templates:
  dcae.collectors.vcc.helloworld.pm:
    type: dcae.nodes.ContainerizedServiceComponentUsingDmaap
    interfaces:
      cloudify.interfaces.lifecycle:
        start:
          inputs:
            ports: []
            envs:
              <<: *envs
              DCAES_DB_NAME:
                get_input: dcaes_database_name
              DCAES_DB_ADMIN_HOST:
                get_attribute:
                - dcaes_pgaasdb
                - admin
                - host
              DCAES_DB_ADMIN_USER:
                get_attribute:
                - dcaes_pgaasdb
                - admin
                - user
              DCAES_DB_ADMIN_PASS:
                get_attribute:
                - dcaes_pgaasdb
                - admin
                - password
              DTI_DB_NAME:
                get_input: dti_database_name
              DTI_DB_ADMIN_HOST:
                get_attribute:
                - dti_pgaasdb
                - admin
                - host
              DTI_DB_ADMIN_USER:
                get_attribute:
                - dti_pgaasdb
                - admin
                - user
              DTI_DB_ADMIN_PASS:
                get_attribute:
                - dti_pgaasdb
                - admin
                - password
              REPO_DB_NAME:
                get_input: repo_database_name
              REPO_DB_ADMIN_HOST:
                get_attribute:
                - repo_pgaasdb
                - admin
                - host
              REPO_DB_ADMIN_USER:
                get_attribute:
                - repo_pgaasdb
                - admin
                - user
              REPO_DB_ADMIN_PASS:
                get_attribute:
                - repo_pgaasdb
                - admin
                - password
    properties:
      application_config:
        service_calls: []
        streams_publishes:
          DCAE-HELLO-WORLD-PUB-DR:
            dmaap_info: <<feed0>>
            type: data_router
          DCAE-HELLO-WORLD-PUB-MR:
            dmaap_info: <<topic1>>
            type: message_router
            pass:
              get_input: DCAE-HELLO-WORLD-PUB-MR_topic1_aaf_password
            user:
              get_input: DCAE-HELLO-WORLD-PUB-MR_topic1_aaf_username
        streams_subscribes:
          DCAE-HELLO-WORLD-SUB-DR:
            dmaap_info: <<feed3>>
            type: data_router
          DCAE-HELLO-WORLD-SUB-MR:
            dmaap_info: <<topic2>>
            type: message_router
            pass:
              get_input: DCAE-HELLO-WORLD-SUB-MR_topic2_aaf_password
            user:
              get_input: DCAE-HELLO-WORLD-SUB-MR_topic2_aaf_username
        isSelfServeComponent: false
        service_component_name_override:
          get_input: service_component_name_override
        useDtiConfig: false
        vcc_hello_name:
          get_input: vcc_hello_name
      docker_config:
        healthcheck:
          interval: 60s
          timeout: 20s
          script: /opt/app/vcc/bin/common/HealthCheck_HelloWorld.sh
          type: docker
        volumes:
        - container:
            bind: /opt/app/dcae-certificate
          host:
            path: /opt/app/dcae-certificate
        - container:
            bind: /opt/logs/DCAE/dmd/AGENT
          host:
            path: /opt/logs/DCAE/helloworldpm/dmd/AGENT
        - container:
            bind: /opt/logs/DCAE/dmd/WATCHER
          host:
            path: /opt/logs/DCAE/helloworldpm/dmd/WATCHER
        - container:
            bind: /opt/app/vcc/logs/DCAE
          host:
            path: /opt/logs/DCAE/helloworldpm/vcc-logs
        - container:
            bind: /opt/app/vcc/archive/data
          host:
            path: /opt/data/DCAE/helloworldpm/vcc-archive
      image:
        get_input: tag_version
      service_component_type: dcae-collectors-vcc-helloworld-pm
      log_info:
        log_directory: /opt/app/VESCollector/logs/ecomp
      replicas:
        get_input: replicas
      streams_publishes:
      - name: feed0
        location:
          get_input: DCAE-HELLO-WORLD-PUB-DR_feed0_location
        type: data_router
      - name: topic1
        location:
          get_input: DCAE-HELLO-WORLD-PUB-MR_topic1_location
        client_role:
          get_input: DCAE-HELLO-WORLD-PUB-MR_topic1_client_role
        type: message_router
      streams_subscribes:
      - name: topic2
        location:
          get_input: DCAE-HELLO-WORLD-SUB-MR_topic2_location
        client_role:
          get_input: DCAE-HELLO-WORLD-SUB-MR_topic2_client_role
        type: message_router
      - name: feed3
        location:
          get_input: DCAE-HELLO-WORLD-SUB-DR_feed3_location
        type: data_router
        username:
          get_input: DCAE-HELLO-WORLD-SUB-DR_feed3_username
        password:
          get_input: DCAE-HELLO-WORLD-SUB-DR_feed3_password
        privileged:
          get_input: DCAE-HELLO-WORLD-SUB-DR_feed3_priviliged
        decompress:
          get_input: DCAE-HELLO-WORLD-SUB-DR_feed3_decompress
        route: /DCAE-HELLO-WORLD-SUB-DR
        scheme: https
      tls_info:
        cert_directory: /opt/app/dh/etc/cert
        use_tls:
          get_input: use_tls
      resource_config:
        limits:
          cpu:
            get_input: dcae.collectors.vcc.helloworld.pm_cpu_limit
          memory:
            get_input: dcae.collectors.vcc.helloworld.pm_memory_limit
        requests:
          cpu:
            get_input: dcae.collectors.vcc.helloworld.pm_cpu_request
          memory:
            get_input: dcae.collectors.vcc.helloworld.pm_memory_request
    relationships:
    - type: ccsdk.relationships.publish_files
      target: feed0
    - type: ccsdk.relationships.publish_events
      target: topic1
    - type: ccsdk.relationships.subscribe_to_events
      target: topic2
    - type: ccsdk.relationships.subscribe_to_files
      target: feed3
    - type: cloudify.relationships.depends_on
      target: tca_policy_00
    - type: cloudify.relationships.depends_on
      target: tca_policy_11
    - type: cloudify.relationships.depends_on
      target: dcaes_pgaasdb
    - type: cloudify.relationships.depends_on
      target: dti_pgaasdb
    - type: cloudify.relationships.depends_on
      target: repo_pgaasdb
  dcaes_pgaasdb:
    type: dcae.nodes.pgaas.database
    properties:
      writerfqdn:
        get_input: dcaes_database_writerfqdn
      name:
        get_input: dcaes_database_name
      use_existing: true
  dti_pgaasdb:
    type: dcae.nodes.pgaas.database
    properties:
      writerfqdn:
        get_input: dti_database_writerfqdn
      name:
        get_input: dti_database_name
      use_existing: true
  feed0:
    type: ccsdk.nodes.Feed
    properties:
      feed_name:
        get_input: feed0_name
  feed3:
    type: ccsdk.nodes.Feed
    properties:
      feed_name:
        get_input: feed3_name
  repo_pgaasdb:
    type: dcae.nodes.pgaas.database
    properties:
      writerfqdn:
        get_input: repo_database_writerfqdn
      name:
        get_input: repo_database_name
      use_existing: true
  tca_policy_00:
    type: clamp.nodes.policy
    properties:
      policy_id:
        get_input: tca_policy_00_policy_id
      policy_model_id: onap.policies.monitoring.cdap.tca.hi.lo.app
  tca_policy_11:
    type: clamp.nodes.policy
    properties:
      policy_id:
        get_input: tca_policy_11_policy_id
      policy_model_id: onap.policies.monitoring.cdap.tca.hi.lo.app
  topic1:
    type: ccsdk.nodes.Topic
    properties:
      topic_name:
        get_input: topic1_name
  topic2:
    type: ccsdk.nodes.Topic
    properties:
      topic_name:
        get_input: topic2_name